# ProtectionExtensions – Structure

## Vue d'ensemble
ProtectionExtensions reprend la configuration standard d'une extension TypeWriter : un module Kotlin 21 piloté par le plugin Gradle `com.typewritermc.module-plugin`, empaqueté sous `src/main/kotlin` et publié via la configuration `typewriter { ... }`.​:codex-file-citation[codex-file-citation]{line_range_start=10 line_range_end=134 path=documentation/docs/develop/02-extensions/02-getting_started.mdx git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/documentation/docs/develop/02-extensions/02-getting_started.mdx#L10-L134"}​

## Packages Kotlin
- `entry.region` — Contient les manifestes décrivant les régions et les actions TypeWriter exposées dans le panneau. On y calque la structure `ManifestEntry`/`TriggerableEntry` déjà utilisée pour des arènes complexes (positions, déclencheurs, artefacts, etc.).​:codex-file-citation[codex-file-citation]{line_range_start=5 line_range_end=74 path=documentation/docs/develop/02-extensions/04-entries/index.mdx git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/documentation/docs/develop/02-extensions/04-entries/index.mdx#L5-L74"}​​:codex-file-citation[codex-file-citation]{line_range_start=22 line_range_end=160 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArcheryGameDefinitionEntry.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArcheryGameDefinitionEntry.kt#L22-L160"}​
- `entry.artifact` — Déclare les artefacts JSON persistants pour stocker les régions, préréglages de flags et journaux d'événements, en s'appuyant sur `ArtifactEntry` et l'AssetManager TypeWriter.​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=38 path=documentation/docs/develop/02-extensions/04-entries/static/asset.mdx git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/documentation/docs/develop/02-extensions/04-entries/static/asset.mdx#L3-L38"}​​:codex-file-citation[codex-file-citation]{line_range_start=9 line_range_end=19 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArenaArtifactEntry.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArenaArtifactEntry.kt#L9-L19"}​
- `flags` — Héberge les enums et tables de dispatch représentant chaque flag WorldGuard (PVP, dégâts, explosions...) et les apports ExtraFlags (commandes à l'entrée/sortie, vitesses, inventaires, etc.).​:codex-file-citation[codex-file-citation]{line_range_start=5 line_range_end=16 path=extensions/ProtectionExtension/Docs/BTC-Protection/README.md git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/ProtectionExtension/Docs/BTC-Protection/README.md#L5-L16"}​​:codex-file-citation[codex-file-citation]{line_range_start=15 line_range_end=39 path=extensions/ProtectionExtension/Docs/BTC-ProtectionExtension/README.md git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/ProtectionExtension/Docs/BTC-ProtectionExtension/README.md#L15-L39"}​
- `service.storage` — Fournit des dépôts et agrégats annotés `@Singleton` pour charger/enregistrer les artefacts, résoudre les héritages de régions et exposer une API thread-safe.​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=78 path=documentation/docs/develop/02-extensions/08-dependency_injection.mdx git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/documentation/docs/develop/02-extensions/08-dependency_injection.mdx#L3-L78"}​​:codex-file-citation[codex-file-citation]{line_range_start=12 line_range_end=22 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/init/ArcheryInitializer.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/init/ArcheryInitializer.kt#L12-L22"}​
- `service.runtime` — Implémente les listeners Paper (rupture de bloc, dégâts, téléportation, projectiles, etc.) et synchronise l'état avec les dépôts de régions, à l'image des gestionnaires d'interaction d'arène.​:codex-file-citation[codex-file-citation]{line_range_start=16 line_range_end=42 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/interaction/ArcheryGameListener.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/interaction/ArcheryGameListener.kt#L16-L42"}​
- `interaction` — Centralise les sessions et garde-fous qui doivent rester actifs sur la durée (sélections, modes d'édition, invites de confirmation) en utilisant le cycle d'interaction TypeWriter (start/stop triggers, priorités, tick).​:codex-file-citation[codex-file-citation]{line_range_start=16 line_range_end=88 path=documentation/docs/develop/02-extensions/05-interactions/index.mdx git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/documentation/docs/develop/02-extensions/05-interactions/index.mdx#L16-L88"}​​:codex-file-citation[codex-file-citation]{line_range_start=55 line_range_end=195 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/interaction/ArcheryInteraction.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/interaction/ArcheryInteraction.kt#L55-L195"}​
- `selection` — Gère les outils de sélection : nodes visuels (via `NodesComponent`) pour l'éditeur interne et adaptateurs WorldEdit pour la commande de sélection, avec validation géométrique (cuboids, polygones, prismes).​:codex-file-citation[codex-file-citation]{line_range_start=32 line_range_end=161 path=engine/engine-paper/src/main/kotlin/com/typewritermc/engine/paper/content/components/NodesComponent.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/engine/engine-paper/src/main/kotlin/com/typewritermc/engine/paper/content/components/NodesComponent.kt#L32-L161"}​
- `command` — Déclare les sous-commandes `/typewriter arena ...` via le DSL Brigadier de TypeWriter (`CommandTree`), y compris la compatibilité WorldEdit et les assistants interactifs.​:codex-file-citation[codex-file-citation]{line_range_start=14 line_range_end=128 path=extensions/TypeWriter-PetsExtension/src/main/kotlin/btc/renaud/pets/command/PetsTypewriterCommand.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-PetsExtension/src/main/kotlin/btc/renaud/pets/command/PetsTypewriterCommand.kt#L14-L128"}​
- `integration` — Contient les ponts éventuels (PlaceholderAPI, modules TypeWriter existants) et les conversions de flags vers d'autres extensions.

## Flux de données
1. Les manifestes `entry.region` créent ou modifient des régions en référencant des artefacts (`regionStorage`, presets, journaux).​:codex-file-citation[codex-file-citation]{line_range_start=68 line_range_end=97 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArcheryGameDefinitionEntry.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArcheryGameDefinitionEntry.kt#L68-L97"}​​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=38 path=documentation/docs/develop/02-extensions/04-entries/static/asset.mdx git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/documentation/docs/develop/02-extensions/04-entries/static/asset.mdx#L3-L38"}​
2. `service.storage` charge ces artefacts au démarrage et expose un graphe des régions (parents, priorités, appartenances).​:codex-file-citation[codex-file-citation]{line_range_start=9 line_range_end=19 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArenaArtifactEntry.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/entry/ArenaArtifactEntry.kt#L9-L19"}​
3. `service.runtime` écoute les événements serveurs, résout la région active et applique les règles (flags, priorités, triggers), en s'appuyant sur les patterns d'interaction asynchrones de TypeWriter.​:codex-file-citation[codex-file-citation]{line_range_start=55 line_range_end=195 path=extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/interaction/ArcheryInteraction.kt git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/TypeWriter-ArcheryGameExtension/src/main/kotlin/btc/renaud/archery/interaction/ArcheryInteraction.kt#L55-L195"}​​:codex-file-citation[codex-file-citation]{line_range_start=16 line_range_end=88 path=documentation/docs/develop/02-extensions/05-interactions/index.mdx git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/documentation/docs/develop/02-extensions/05-interactions/index.mdx#L16-L88"}​
4. `command` et `selection` offrent les outils d'administration (création, édition, import/export), tandis que `interaction` gère les sessions utilisateurs persistantes.

## Compatibilité et cibles
- Reprendre l'intégralité des familles de flags WorldGuard (protection, combat, explosions, interactions) et les ajouts ExtraFlags (commandes, vitesses, effets, inventaires) pour supprimer la dépendance directe à WorldGuard tout en conservant les fonctionnalités existantes.​:codex-file-citation[codex-file-citation]{line_range_start=5 line_range_end=16 path=extensions/ProtectionExtension/Docs/BTC-Protection/README.md git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/ProtectionExtension/Docs/BTC-Protection/README.md#L5-L16"}​​:codex-file-citation[codex-file-citation]{line_range_start=15 line_range_end=39 path=extensions/ProtectionExtension/Docs/BTC-ProtectionExtension/README.md git_url="https://github.com/RenaudRl/BTC-Typewriter/blob/main/extensions/ProtectionExtension/Docs/BTC-ProtectionExtension/README.md#L15-L39"}​
- Viser Paper 1.21.8+ : la détection des évènements (projectiles, dégâts, interactions) et les API de sélection doivent rester compatibles avec les évolutions Paper/Folia récentes.
